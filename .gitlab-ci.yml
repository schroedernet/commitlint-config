default:
  before_script:
    - 'apk update'
    - 'apk upgrade'
    - 'apk add git nodejs-current npm shellcheck'
    - 'npm install --cache .npm-cache --global --prefer-offline yarn'
    - 'yarn install --cache-folder .yarn-cache --frozen-lockfile --prefer-offline'

  cache:
    key:
      files:
        - 'yarn.lock'

    paths:
      - '.npm-cache'
      - '.yarn-cache'

  image: 'alpine:latest'

lint:
  script:
    - 'yarn run lint'

  stage: 'lint'

pack:
  artifacts:
    paths:
      - 'schroedernet-commitlint-config-git-${CI_COMMIT_SHA}.tgz'

  script:
    - 'yarn pack --filename "schroedernet-commitlint-config-git-${CI_COMMIT_SHA}.tgz"'

  stage: 'pack'

stages:
  - 'lint'
  - 'test'
  - 'pack'

test:
  artifacts:
    reports:
      cobertura: 'tmp/test/reports/coverage/cobertura-coverage.xml'
      junit: 'tmp/test/reports/unit/junit.xml'

    when: 'always'

  coverage: '/All files.*\s+(\d+)\s+\|.*$/'

  script:
    - 'yarn run test --ci'

  stage: 'test'
